# 排行榜实现说明

## 核心策略
采用**懒加载**策略，只在用户展开榜单时才加载数据，提升性能和用户体验。

## 关键实现

### 1. 展开时加载
```javascript
async expandRank(rank) {
    rank.expanded = !rank.expanded
    
    // 展开且未加载过，则加载数据
    if (rank.expanded && rank.songs.length === 0) {
        await this.loadRankSongs(rank)
    }
}
```

### 2. 基础信息优先
```javascript
rank.songs = songs.map(song => ({
    id: song.id,
    name: song.name,
    artistName: song.artists?.map(artist => artist.name).join(', ') || '未知歌手',
    albumName: song.album?.name || song.al?.name || '未知专辑',
    albumPic: '/static/logo.png', // 默认封面，快速显示
    url: `https://music.163.com/song/media/outer/url?id=${song.id}.mp3`,
    vip: song.fee === 1
}))
```

### 3. 详细信息按需加载
点击播放时，`SongList` 组件自动加载完整封面图，并缓存避免重复请求。

## 数据流程

```
打开页面 → 显示榜单卡片（仅名称、图标、描述）
    ↓
点击榜单 → 展开并加载基础歌曲信息（20首）
    ↓
显示列表（默认封面） → 点击播放 → 加载完整封面 → 缓存 → 播放
```

## 技术要点

1. **智能缓存**：已加载的榜单和歌曲详情不重复请求
2. **下拉刷新**：只刷新已展开的榜单
3. **响应式更新**：直接修改 rank 对象属性触发视图更新
4. **组件复用**：复用 `SongList` 组件继承其按需加载能力

## 榜单配置

```javascript
{
    id: 1,
    name: '🔥 华语热歌榜',
    desc: '最热门的华语流行音乐',
    icon: '🎵',
    gradient: '...',
    keyword: '华语热歌',      // 搜索关键词
    expanded: false,          // 是否展开
    loading: false,           // 加载状态
    songs: [],               // 歌曲列表
    preview: ['歌名1', ...]  // 预览歌名
}
```

## 性能对比

| 模式 | 初始加载 | 首次展开 | 请求数 |
|------|---------|---------|--------|
| 批量加载 | 8-15秒 | - | 160次 |
| **按需加载** ✅ | **<1秒** | **1-2秒** | **按需** |

## 总结

✅ 页面秒开  
✅ 按需请求  
✅ 智能缓存  
✅ 流畅体验

