# API ç»Ÿä¸€æ€§æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ—¶é—´
2025-10-16 13:48

## âœ… åç«¯ API ç«¯ç‚¹æ¸…å•

### ç”¨æˆ·è®¤è¯ç›¸å…³
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| POST | `/register` | ç”¨æˆ·æ³¨å†Œ | âœ… å·²ç»Ÿä¸€ |
| POST | `/login` | ç”¨æˆ·ç™»å½• | âœ… å·²ç»Ÿä¸€ |

### ç”¨æˆ·ä¿¡æ¯ç›¸å…³
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| POST | `/uploadAvatar` | ä¸Šä¼ å¤´åƒ | âœ… å·²ç»Ÿä¸€ |
| POST | `/updateUser` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | âœ… å·²ç»Ÿä¸€ |

### æ”¶è—åŠŸèƒ½ç›¸å…³
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| GET | `/favorites/:userId` | è·å–ç”¨æˆ·æ”¶è—åˆ—è¡¨ | âœ… å·²ç»Ÿä¸€ |
| POST | `/favorites/add` | æ·»åŠ æ”¶è— | âœ… å·²ç»Ÿä¸€ |
| POST | `/favorites/delete` | åˆ é™¤æ”¶è— | âœ… å·²ç»Ÿä¸€ |
| POST | `/favorites/clear` | æ¸…ç©ºæ”¶è— | âœ… å·²ç»Ÿä¸€ |

### æ’­æ”¾å†å²ç›¸å…³
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| GET | `/history/:userId` | è·å–æ’­æ”¾å†å² | âœ… å·²ç»Ÿä¸€ |
| POST | `/history/add` | æ·»åŠ æ’­æ”¾å†å² | âœ… å·²ç»Ÿä¸€ |
| POST | `/history/clear` | æ¸…ç©ºæ’­æ”¾å†å² | âœ… å·²ç»Ÿä¸€ |

## âœ… å‰ç«¯ API è°ƒç”¨ç»Ÿä¸€æ£€æŸ¥

### ä½¿ç”¨ `getApiUrl()` çš„æ–‡ä»¶

#### 1. `pages/login/login.vue`
- âœ… `/login` - ç™»å½•
- âœ… `/favorites/:userId` - è·å–æ”¶è—
- âœ… `/history/:userId` - è·å–å†å²

#### 2. `pages/register/register.vue`
- âœ… `/register` - æ³¨å†Œ

#### 3. `pages/settings/settings.vue`
- âœ… `/uploadAvatar` - ä¸Šä¼ å¤´åƒ
- âœ… `/login` - éªŒè¯æ—§å¯†ç 
- âœ… `/updateUser` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

#### 4. `pages/mine/mine.vue`
- âœ… `/favorites/:userId` - è·å–æ”¶è—
- âœ… `/history/:userId` - è·å–å†å²

#### 5. `store/index.js`
- âœ… `/favorites/add` - æ·»åŠ æ”¶è—
- âœ… `/favorites/delete` - åˆ é™¤æ”¶è—
- âœ… `/favorites/clear` - æ¸…ç©ºæ”¶è—
- âœ… `/history/add` - æ·»åŠ å†å²
- âœ… `/history/clear` - æ¸…ç©ºå†å²

### ç½‘æ˜“äº‘éŸ³ä¹ API è°ƒç”¨æ£€æŸ¥

#### ä½¿ç”¨ç»Ÿä¸€ä»£ç†çš„ APIï¼ˆé€šè¿‡ `utils/api.js`ï¼‰
- âœ… `/api/search/get/web` - æœç´¢éŸ³ä¹ï¼ˆæ”¯æŒH5ä»£ç†ï¼‰
- âœ… `/api/song/lyric` - è·å–æ­Œè¯ï¼ˆæ”¯æŒH5ä»£ç†ï¼‰
- âœ… `/api/song/detail` - è·å–æ­Œæ›²è¯¦æƒ…ï¼ˆæ”¯æŒH5ä»£ç†ï¼‰

#### éŸ³é¢‘æ’­æ”¾é“¾æ¥ï¼ˆä¸éœ€è¦ä»£ç†ï¼‰
ä»¥ä¸‹æ˜¯ç›´æ¥çš„éŸ³é¢‘æ–‡ä»¶é“¾æ¥ï¼Œæµè§ˆå™¨å¯ä»¥ç›´æ¥æ’­æ”¾ï¼Œä¸å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼š
- `https://music.163.com/song/media/outer/url?id={songId}.mp3`

ä½ç½®ï¼š
- `utils/api.js` (getBatchSongDetailsæ–¹æ³•)
- `pages/index/index.vue`
- `pages/discover/discover.vue`
- `pages/search/search.vue`

## ğŸ“Š ç»Ÿä¸€æ€§æ£€æŸ¥ç»“æœ

### âœ… åç«¯æœåŠ¡å™¨ API
- **æ€»æ•°**: 11 ä¸ªç«¯ç‚¹
- **å·²ç»Ÿä¸€**: 11 ä¸ª âœ…
- **æœªç»Ÿä¸€**: 0 ä¸ª
- **ç»Ÿä¸€ç‡**: 100%

### âœ… å‰ç«¯ API è°ƒç”¨
- **æ€»è°ƒç”¨ç‚¹**: 14 å¤„
- **å·²ä½¿ç”¨ `getApiUrl()`**: 14 å¤„ âœ…
- **ç¡¬ç¼–ç  URL**: 0 å¤„
- **ç»Ÿä¸€ç‡**: 100%

### âœ… ç½‘æ˜“äº‘éŸ³ä¹ API
- **æ€»è°ƒç”¨ç‚¹**: 3 ä¸ª API æ–¹æ³•
- **å·²ä½¿ç”¨ä»£ç†**: 3 ä¸ª âœ…
- **ç»Ÿä¸€ç‡**: 100%

## ğŸ¯ è·¨åŸŸé—®é¢˜è§£å†³æ–¹æ¡ˆ

### åç«¯æœåŠ¡å™¨ï¼ˆlocalhost:3000ï¼‰
```javascript
// iMusic-server/server.js
app.use(cors({
  origin: ['http://localhost:8080', 'http://127.0.0.1:8080', 'http://localhost:3000'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));
```

### å‰ç«¯ç»Ÿä¸€é…ç½®
```javascript
// Uniapp_iMusic/utils/config.js
export function getApiUrl(path) {
  const baseUrl = getServerURL()  // è‡ªåŠ¨æ ¹æ®ç¯å¢ƒè¿”å›æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€
  const apiPath = path.startsWith('/') ? path : `/${path}`
  return `${baseUrl}${apiPath}`
}
```

### H5 ä»£ç†é…ç½®ï¼ˆmanifest.jsonï¼‰
```json
{
  "h5": {
    "devServer": {
      "proxy": {
        "/api": {
          "target": "http://music.163.com",
          "changeOrigin": true,
          "secure": false
        }
      }
    }
  }
}
```

## ğŸ” æ½œåœ¨é—®é¢˜æ£€æŸ¥

### âœ… å·²è§£å†³çš„é—®é¢˜
1. âœ… åç«¯ CORS é…ç½®å®Œå–„
2. âœ… å‰ç«¯æ‰€æœ‰ API è°ƒç”¨ä½¿ç”¨ç»Ÿä¸€é…ç½®
3. âœ… ç½‘æ˜“äº‘éŸ³ä¹ API ä½¿ç”¨ä»£ç†ï¼ˆH5ç¯å¢ƒï¼‰
4. âœ… æ”¶è—å’Œå†å²åŠŸèƒ½æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼ˆæ¸¸å®¢æ¨¡å¼ï¼‰
5. âœ… é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆå®Œå–„

### âš ï¸ æ³¨æ„äº‹é¡¹

#### 1. éŸ³é¢‘æ’­æ”¾é™åˆ¶
ç½‘æ˜“äº‘éŸ³ä¹çš„å¤–é“¾éŸ³é¢‘å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š
- éƒ¨åˆ†æ­Œæ›²éœ€è¦ VIP æƒé™
- å¤–é“¾å¯èƒ½å¤±æ•ˆæˆ–è¢«é™åˆ¶
- å»ºè®®ï¼šå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹éŸ³ä¹ API æˆ–è‡ªå»ºéŸ³ä¹æœåŠ¡å™¨

#### 2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
å¼€å‘ç¯å¢ƒçš„ä»£ç†é…ç½®åœ¨ç”Ÿäº§ç¯å¢ƒæ— æ•ˆï¼Œéœ€è¦ï¼š
- é…ç½® Nginx åå‘ä»£ç†
- æˆ–ä½¿ç”¨åç«¯æœåŠ¡è½¬å‘
- æˆ–ä½¿ç”¨æ”¯æŒ CORS çš„ç¬¬ä¸‰æ–¹ API

#### 3. æ¸¸å®¢æ¨¡å¼
æ¸¸å®¢æ¨¡å¼ä¸‹ï¼š
- âœ… æ”¯æŒæœ¬åœ°æ”¶è—ï¼ˆå­˜å‚¨åœ¨ localStorageï¼‰
- âœ… æ”¯æŒæ’­æ”¾å†å²ï¼ˆå­˜å‚¨åœ¨ localStorageï¼‰
- âŒ ä¸æ”¯æŒè·¨è®¾å¤‡åŒæ­¥
- âœ… ç™»å½•åå¯ä»¥å°†æœ¬åœ°æ•°æ®åŒæ­¥åˆ°æœåŠ¡å™¨