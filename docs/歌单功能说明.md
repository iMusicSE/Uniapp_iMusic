# 歌单功能说明

## 功能概述

实现了完整的歌单浏览和播放功能，包括歌单列表、歌单详情页、歌曲播放等核心功能，并支持本地缓存优化用户体验。

## 功能特性

### 1. 歌单列表页 (`/pages/playlist-list/playlist-list.vue`)

- ✅ 网格布局展示推荐歌单
- ✅ 显示歌单封面、名称、播放量
- ✅ 支持下拉刷新
- ✅ 点击歌单进入详情页

#### 推荐歌单 ID 列表
```javascript
playlistIds: [
  1997190595, 14096260145, 5017390341, 2374577728,
  3778678, 19723756, 3779629, 2884035
]
```

### 2. 歌单详情页 (`/pages/playlist-detail/playlist-detail.vue`)

#### 核心功能
- ✅ 展示歌单封面、名称、描述、播放量
- ✅ 显示歌单中的所有歌曲（带封面）
- ✅ 支持播放单首歌曲
- ✅ 支持播放全部歌曲
- ✅ 本地缓存优化（缓存歌单信息和歌曲列表）
- ✅ 支持下拉刷新（清除缓存并重新加载）

#### 页面结构
```
歌单详情页
├── 顶部信息区
│   ├── 模糊背景
│   ├── 歌单封面（带播放量）
│   └── 歌单信息（名称、描述、歌曲数）
├── 操作按钮
│   ├── 播放全部
│   └── 收藏（待开发）
└── 歌曲列表
    ├── 序号
    ├── 封面
    ├── 歌曲名
    └── 歌手名
```

### 3. 缓存机制

#### 缓存内容
歌单详情页会缓存以下数据：
- 歌单基本信息（ID、名称、封面、播放量、描述）
- 歌单曲目列表（tracks）
- **歌曲详细信息（songList）** - 包含每首歌的完整信息和封面

#### 缓存策略
```javascript
// 缓存数据结构
{
  id: 歌单ID,
  name: 歌单名称,
  cover: 封面URL,
  playCount: 播放量,
  description: 描述,
  tracks: 原始曲目列表,
  songList: 完整歌曲详情（含封面）
}
```

#### 缓存流程
1. **首次加载**：
   - 检查缓存，如果有完整数据（含 songList）直接使用
   - 如果无缓存，从网络加载
   - 加载完成后保存到缓存（包含歌曲详情）

2. **下拉刷新**：
   - 清除该歌单的缓存
   - 重新从网络加载
   - 重新保存到缓存

3. **缓存过期时间**：3天
   ```javascript
   PLAYLIST_DETAIL: {
     prefix: 'playlist_detail_',
     expire: 3 * 24 * 60 * 60 * 1000 // 3天
   }
   ```

### 4. 播放功能

#### 播放单首歌曲
```javascript
playSong(song, index) {
  this.$store.dispatch('player/playSong', {
    song: song,
    playlist: this.songList  // 传入完整歌单作为播放列表
  })
}
```

#### 播放全部
```javascript
playAll() {
  this.$store.dispatch('player/playSong', {
    song: this.songList[0],  // 第一首歌曲
    playlist: this.songList  // 完整歌单
  })
}
```

### 5. 入口位置

#### 5.1 发现页
- 位置：推荐歌单区域
- 点击任意歌单卡片 → 进入歌单详情

#### 5.2 我的页面
- 位置：快捷菜单 → 我的歌单
- 点击进入 → 歌单列表页 → 选择歌单 → 歌单详情

## 使用的 API

### 1. 获取歌单详情
```javascript
getPlaylistDetail(playlistId)
```
- 返回歌单基本信息和曲目列表

### 2. 批量获取歌曲详情
```javascript
getBatchSongDetails(songIds, onProgress)
```
- 批量获取歌曲的完整信息（含封面）
- 支持进度回调
- 自动重试机制

### 3. 批量获取歌单详情（发现页使用）
```javascript
getBatchPlaylistDetails(playlistIds)
```
- 带缓存和重试机制
- 用于歌单列表页加载多个歌单

## 页面路由配置

```json
{
  "path": "pages/playlist-detail/playlist-detail",
  "style": {
    "navigationBarTitleText": "歌单详情",
    "navigationBarBackgroundColor": "#667eea",
    "navigationBarTextStyle": "white",
    "enablePullDownRefresh": true
  }
},
{
  "path": "pages/playlist-list/playlist-list",
  "style": {
    "navigationBarTitleText": "我的歌单",
    "navigationBarBackgroundColor": "#667eea",
    "navigationBarTextStyle": "white",
    "enablePullDownRefresh": true
  }
}
```

## 数据流

```
用户操作 → 歌单列表/发现页
    ↓
点击歌单卡片
    ↓
进入歌单详情页
    ↓
检查缓存
    ├── 有缓存（含songList）→ 直接显示
    └── 无缓存 → 从网络加载
            ↓
        获取歌单详情
            ↓
        批量获取歌曲详情
            ↓
        保存到缓存（含songList）
            ↓
        显示歌单和歌曲
            ↓
        用户点击歌曲/播放全部
            ↓
        调用播放器播放
```

## 性能优化

### 1. 缓存优化
- ✅ 缓存歌单基本信息
- ✅ **缓存完整歌曲列表**（避免重复请求）
- ✅ 设置3天过期时间
- ✅ 支持手动刷新清除缓存

### 2. 加载优化
- ✅ 优先从缓存加载
- ✅ 批量请求歌曲详情（10首/批次）
- ✅ 显示加载进度
- ✅ 失败自动重试

### 3. 用户体验
- ✅ 加载状态提示
- ✅ 缓存加载提示
- ✅ 下拉刷新
- ✅ 空状态提示
- ✅ 错误处理

## 待优化功能

1. [ ] 收藏歌单功能
2. [ ] 歌单搜索
3. [ ] 更多歌单分类
4. [ ] 歌单评论
5. [ ] 歌单分享

## 相关文件

- `pages/playlist-detail/playlist-detail.vue` - 歌单详情页
- `pages/playlist-list/playlist-list.vue` - 歌单列表页
- `pages/discover/discover.vue` - 发现页（含推荐歌单）
- `pages/mine/mine.vue` - 我的页面（入口）
- `utils/api.js` - API 接口
- `utils/cache.js` - 缓存管理
- `store/modules/player.js` - 播放器状态管理

