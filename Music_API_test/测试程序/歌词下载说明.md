# 网易云音乐歌词下载功能说明

## 功能特性

### 1. 支持的歌词类型
- ✅ **原文歌词** - LRC格式（带时间轴）
- ✅ **翻译歌词** - 中文翻译
- ✅ **罗马音歌词** - 日文歌曲的罗马拼音
- ✅ **纯文本歌词** - 无时间轴的文本格式

### 2. 保存格式
程序会自动保存多种格式的歌词文件：

| 文件名格式 | 说明 |
|-----------|------|
| `歌曲名 - 歌手名.lrc` | 原文LRC歌词（带时间轴） |
| `歌曲名 - 歌手名.txt` | 纯文本歌词（无时间轴） |
| `歌曲名 - 歌手名_双语.lrc` | 双语LRC歌词（原文+翻译） |
| `歌曲名 - 歌手名_罗马音.lrc` | 罗马音LRC歌词 |

### 3. API接口说明

**歌词API地址：**
```
http://music.163.com/api/song/lyric
```

**请求参数：**
- `id`: 歌曲ID（必需）
- `lv`: 原文歌词版本，-1表示最新版本
- `kv`: 卡拉OK版本，-1表示最新版本
- `tv`: 翻译版本，-1表示最新版本

**示例请求：**
```
http://music.163.com/api/song/lyric?id=185668&lv=-1&kv=-1&tv=-1
```

## 使用方法

### 方式1: 运行测试程序
```bash
python lyrics_download_test.py
```

然后按照提示：
1. 选择 `1` - 输入歌曲ID手动测试
2. 选择 `2` - 使用预设示例自动测试
3. 选择 `3` - 退出程序

### 方式2: 在代码中调用

```python
from lyrics_download_test import get_lyrics, save_lyrics

# 获取歌词
song_id = "185668"  # 周杰伦 - 晴天
lyrics_data = get_lyrics(song_id)

# 保存歌词
if lyrics_data.get('success'):
    save_lyrics("晴天", "周杰伦", lyrics_data)
```

## 示例测试

### 示例1：有歌词的歌曲
- **歌曲**: 晴天
- **歌手**: 周杰伦
- **歌曲ID**: 185668
- **结果**: 可以下载原文歌词（LRC和TXT格式）

### 示例2：纯音乐
- **歌曲**: Suite bergamasque, L.75 - 3. Clair de lune
- **歌手**: Pascal Rogé
- **歌曲ID**: 496869422
- **结果**: 纯音乐通常没有歌词

### 示例3：带翻译的外语歌曲
对于一些外语歌曲（如日韩歌曲），网易云可能提供翻译歌词，程序会自动生成双语LRC文件。

## LRC格式说明

LRC是一种歌词文件格式，包含时间轴信息：

```
[00:00.00]歌曲名 - 歌手名
[00:05.23]第一句歌词
[00:10.45]第二句歌词
[00:15.67]第三句歌词
```

格式说明：
- `[mm:ss.xx]` - 时间标签（分:秒.毫秒）
- 时间标签后面是对应时刻的歌词文本

## 常见问题

### Q1: 为什么有些歌曲下载不到歌词？
**A:** 可能的原因：
- 歌曲是纯音乐，本身没有歌词
- 版权方未提供歌词
- 歌曲较新，歌词尚未收录

### Q2: 歌词文件保存在哪里？
**A:** 默认保存在项目的 `音乐下载` 目录中，可以在代码中修改保存路径。

### Q3: 如何获取歌曲ID？
**A:** 有两种方法：
1. 使用 `netease_music_search.py` 程序搜索歌曲获取ID
2. 在网易云音乐网页版打开歌曲，从URL中获取：
   - URL格式：`https://music.163.com/song?id=185668`
   - ID就是 `185668`

### Q4: 双语歌词是如何合并的？
**A:** 程序会根据时间轴匹配，将翻译歌词插入到原文歌词的下方，格式如下：
```
[00:05.23]原文歌词
  (中文翻译)
[00:10.45]下一句原文
  (下一句翻译)
```

## 整合建议

如果想将歌词下载功能整合到UI界面中，可以：

1. 在 `music_search_ui.py` 中添加"下载歌词"按钮
2. 在下载音乐时同时下载歌词
3. 保存歌词文件到与音乐文件相同的目录

示例代码片段：
```python
def download_with_lyrics(self, song):
    """同时下载音乐和歌词"""
    song_id = song.get('id')
    song_name = song.get('name')
    artist_name = self.get_artist_names(song)
    
    # 下载音乐
    self.download_music(song)
    
    # 下载歌词
    from lyrics_download_test import get_lyrics, save_lyrics
    lyrics_data = get_lyrics(song_id)
    if lyrics_data.get('success'):
        save_lyrics(song_name, artist_name, lyrics_data)
```

## 技术细节

### API响应结构
```json
{
  "code": 200,
  "lrc": {
    "lyric": "[00:00.00]原文歌词内容..."
  },
  "tlyric": {
    "lyric": "[00:00.00]翻译歌词内容..."
  },
  "romalrc": {
    "lyric": "[00:00.00]罗马音歌词内容..."
  }
}
```

### 错误处理
程序包含完善的错误处理机制：
- ✅ 网络请求超时处理
- ✅ JSON解析错误处理
- ✅ 文件保存异常处理
- ✅ 文件名非法字符过滤

## 注意事项

⚠️ **版权说明**
- 歌词内容受版权保护
- 仅供个人学习和测试使用
- 请勿用于商业用途

⚠️ **使用限制**
- 请合理控制请求频率，避免对服务器造成压力
- 建议添加请求间隔（1-2秒）

## 更新日志

### v1.0 (2025-10-11)
- ✨ 初始版本发布
- ✅ 支持原文、翻译、罗马音歌词获取
- ✅ 支持LRC和TXT格式保存
- ✅ 支持双语歌词合并
- ✅ 完善的错误处理和日志输出

