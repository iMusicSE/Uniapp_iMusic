# 网易云音乐搜索下载器 - 详细使用指南

## 📦 快速开始

### 1. 安装依赖
打开命令行，进入`UI界面`文件夹，运行：
```bash
pip install -r requirements.txt
```

### 2. 启动程序
**方式一**：双击 `启动程序.bat`  
**方式二**：命令行运行 `python music_search_ui.py`

## 🎵 功能详解

### 一、搜索功能

1. **输入歌曲名称**
   - 在顶部的输入框中输入你想搜索的歌曲名称
   - 支持歌曲名、歌手名等关键词
   - 例如：输入"稻香"、"周杰伦"等

2. **执行搜索**
   - 点击"搜索"按钮
   - 或者直接按Enter键
   - 程序会自动获取前10个搜索结果

3. **查看搜索结果**
   - 左侧表格显示搜索到的歌曲列表
   - 包含：序号、歌曲名、歌手、专辑
   - 表格支持滚动查看

### 二、API信息展示

#### API调用信息窗口（右上）
搜索后，这个窗口会显示：
- **请求方法**：GET
- **API地址**：http://music.163.com/api/search/get/web
- **请求参数**：
  ```json
  {
    "s": "搜索关键词",
    "type": 1,
    "offset": 0,
    "limit": 10
  }
  ```
- **请求头**：User-Agent、Referer等
- **响应状态码**：200表示成功
- **响应时间**：请求耗时
- **响应数据**：返回的JSON数据（部分显示）

#### URL解析窗口（右下）
显示每首歌曲的详细信息：
- **歌曲信息**：歌曲名 - 歌手
- **歌曲ID**：网易云音乐的唯一标识
- **下载URL**：完整的下载链接
- **URL组成说明**：
  - 基础URL：`http://music.163.com/song/media/outer/url`
  - 参数id：歌曲的唯一ID
  - 文件格式：`.mp3`

**示例**：
```
1. 稻香 - 周杰伦
   歌曲ID: 186016
   下载URL: http://music.163.com/song/media/outer/url?id=186016.mp3
   URL组成说明:
     - 基础URL: http://music.163.com/song/media/outer/url
     - 参数 id: 186016
     - 文件格式: .mp3
```

### 三、下载功能

#### 歌词下载选项 🆕
在下载歌曲前，你可以选择是否同时下载歌词：
- **复选框位置**：在下载按钮上方
- **默认状态**：已勾选（同时下载歌词）
- **歌词格式**：
  - **LRC格式**：带时间轴的歌词文件（可用于播放器同步显示）
  - **TXT格式**：纯文本歌词（方便阅读）
  - **双语版本**：如果歌曲有翻译，会额外保存双语TXT文件

#### 方法一：使用下载按钮
1. 在搜索结果中**单击选中**一首歌曲（行会高亮）
2. **选择是否下载歌词**（勾选或取消"同时下载歌词（LRC + TXT）"）
3. 点击"下载选中的歌曲"按钮
4. 在弹出的对话框中选择保存位置和文件名
5. 点击"保存"，等待下载完成

#### 方法二：双击下载
1. 直接**双击**要下载的歌曲
2. 在弹出的对话框中选择保存位置和文件名
3. 点击"保存"，等待下载完成
4. 如果勾选了歌词选项，会自动下载歌词到同一目录

#### 下载过程说明
- 下载时按钮会显示"下载中..."
- 底部状态栏显示下载进度
- 格式：`音乐下载进度: XX.X% (已下载/总大小 字节)`
- 如果勾选了歌词选项，音乐下载完成后会自动下载歌词
- 状态栏会显示"正在下载歌词..."
- 下载完成后会弹出提示框，显示已保存的文件信息

#### 下载文件说明 🆕
下载完成后，会在你选择的目录中生成以下文件：

**基本文件**（总是生成）：
- `歌曲名 - 歌手.mp3` - 音乐文件

**歌词文件**（勾选歌词选项时生成）：
- `歌曲名 - 歌手.lrc` - LRC格式歌词（带时间轴）
- `歌曲名 - 歌手.txt` - TXT格式歌词（纯文本）
- `歌曲名 - 歌手_双语.txt` - 双语歌词（如果有翻译）

**示例**：
```
下载目录/
  ├── 晴天 - 周杰伦.mp3          # 音乐文件
  ├── 晴天 - 周杰伦.lrc          # LRC歌词
  └── 晴天 - 周杰伦.txt          # TXT歌词
```

## 🎯 界面元素说明

### 顶部搜索栏
- **输入框**：输入歌曲名称
- **搜索按钮**：执行搜索（也可按Enter键）

### 左侧区域
- **搜索结果表格**：显示搜索到的歌曲
  - 序号：1-10
  - 歌曲名：歌曲标题
  - 歌手：演唱者（多个歌手用逗号分隔）
  - 专辑：所属专辑名称
- **歌词下载选项** 🆕：复选框，选择是否同时下载歌词
- **下载按钮**：下载选中的歌曲

### 右侧区域
- **API调用信息**：显示HTTP请求的详细信息
- **URL解析详情**：显示每首歌曲的下载链接构成

### 底部状态栏
显示当前操作状态：
- "就绪"：等待操作
- "正在搜索: XXX"：搜索进行中
- "找到 X 首歌曲"：搜索完成
- "正在下载音乐: XXX"：音乐下载进行中
- "音乐下载进度: XX.X%"：音乐下载进度
- "正在下载歌词..." 🆕：歌词下载进行中
- "下载完成"：全部下载成功

## 💡 使用技巧

1. **快速搜索**：输入歌曲名后直接按Enter键
2. **快速下载**：双击歌曲即可下载
3. **查看详情**：观察右侧窗口了解API调用过程
4. **批量查看**：搜索后可以在URL解析窗口看到所有歌曲的下载链接
5. **歌词同步** 🆕：默认会下载LRC和TXT两种格式的歌词
6. **播放器支持** 🆕：LRC文件可以在支持歌词显示的播放器中使用
7. **文件管理** 🆕：音乐和歌词会保存在同一目录，方便管理

## ⚠️ 注意事项

### 1. VIP歌曲限制
- 部分歌曲需要网易云音乐VIP会员
- 这些歌曲无法直接下载
- 下载时如果文件很小（<1KB），说明下载失败

### 2. 网络要求
- 需要稳定的网络连接
- 搜索和下载都需要访问网易云音乐服务器
- 如果网络不稳定，可能会失败

### 3. 文件名处理
- 程序会自动去除文件名中的非法字符
- 默认格式：`歌曲名 - 歌手.mp3`
- 歌词文件会使用相同的文件名（不同扩展名）
- 可以在保存对话框中修改音乐文件名

### 4. 歌词下载说明 🆕
- 部分歌曲可能没有歌词（如纯音乐）
- 如果歌曲无歌词，会显示提示信息但不影响音乐下载
- LRC文件包含时间轴信息，可在支持的播放器中同步显示
- TXT文件是纯文本，方便复制和阅读
- 如果歌曲有翻译，会额外生成双语版本

### 5. 版权说明
- 请遵守相关版权法规
- 仅供个人学习和研究使用
- 不得用于商业目的

## 🐛 常见问题

### Q1: 点击搜索没反应？
**A**: 
- 检查是否输入了歌曲名称
- 检查网络连接是否正常
- 查看状态栏是否显示错误信息

### Q2: 搜索结果为空？
**A**: 
- 尝试更换搜索关键词
- 使用更准确的歌曲名或歌手名
- 检查网络连接

### Q3: 下载的文件无法播放？
**A**: 
- 检查文件大小，如果很小（<1KB）说明下载失败
- 可能是VIP歌曲，无法免费下载
- 尝试下载其他歌曲

### Q4: 下载速度很慢？
**A**: 
- 取决于网络速度和服务器响应
- 状态栏会显示下载进度
- 耐心等待下载完成

### Q5: 程序无法启动？
**A**: 
- 确保已安装Python 3.x
- 确保已安装requests库：`pip install requests`
- 检查是否有防火墙阻止

### Q6: 为什么有些歌曲没有歌词？ 🆕
**A**: 
- 纯音乐通常没有歌词
- 部分老歌或小众歌曲可能缺少歌词数据
- 不影响音乐文件的下载
- 会显示"该歌曲暂无歌词"的提示

### Q7: LRC文件如何使用？ 🆕
**A**: 
- LRC文件是带时间轴的歌词文件
- 可在支持LRC的音乐播放器中使用（如：Foobar2000、网易云音乐等）
- 将LRC文件和MP3文件放在同一目录，播放器会自动识别
- 文件名必须保持一致（只有扩展名不同）

### Q8: 歌词文件显示乱码？ 🆕
**A**: 
- 歌词文件使用UTF-8编码保存
- 如果显示乱码，请使用支持UTF-8的文本编辑器打开
- 推荐使用：Notepad++、VS Code、记事本（Windows 10+）

## 📊 技术细节

### API说明
**搜索API**
```
URL: http://music.163.com/api/search/get/web
方法: GET
参数:
  - s: 搜索关键词
  - type: 1（单曲）
  - offset: 偏移量
  - limit: 返回数量
```

**音乐下载URL格式**
```
http://music.163.com/song/media/outer/url?id={歌曲ID}.mp3
```

**歌词API** 🆕
```
URL: http://music.163.com/api/song/lyric
方法: GET
参数:
  - id: 歌曲ID
  - lv: -1（原文歌词版本）
  - kv: -1（卡拉OK版本）
  - tv: -1（翻译版本）
返回:
  - lrc.lyric: 原文歌词（LRC格式）
  - tlyric.lyric: 翻译歌词（LRC格式）
  - romalrc.lyric: 罗马音歌词（LRC格式）
```

### 实现技术
- **GUI框架**：tkinter（Python内置）
- **HTTP请求**：requests库
- **多线程**：threading模块（避免界面卡顿）
- **JSON解析**：json模块
- **正则表达式** 🆕：re模块（歌词格式转换）
- **文件操作**：os模块（路径处理和文件保存）

### 程序特点
1. **界面友好**：直观的图形界面
2. **信息详细**：显示完整的API调用过程
3. **异步处理**：网络请求不阻塞界面
4. **实时反馈**：下载进度实时显示
5. **错误处理**：完善的异常处理机制
6. **多格式支持** 🆕：同时下载LRC和TXT格式歌词
7. **智能文件管理** 🆕：自动保存到相同目录
8. **双语歌词** 🆕：自动识别并保存翻译版本

## 🔧 高级功能

### 查看完整API响应
右侧"API调用信息"窗口会显示：
- 完整的请求参数
- 响应状态码
- 响应时间
- 部分响应数据（前1000字符）

### 理解URL构成
右侧"URL解析详情"窗口详细说明了每个下载链接的构成：
- 基础URL是固定的
- 每首歌曲有唯一的ID
- 通过ID参数获取MP3文件

这些信息对于学习API调用和理解程序工作原理非常有帮助。

## 📝 更新日志

### v2.0.0 (当前版本) 🆕
- ✅ **新增歌词下载功能**
  - 支持LRC格式（带时间轴）
  - 支持TXT格式（纯文本）
  - 自动识别并保存双语歌词
- ✅ **新增歌词下载选项**
  - 可选择是否同时下载歌词
  - 默认启用歌词下载
- ✅ **改进文件管理**
  - 音乐和歌词自动保存到同一目录
  - 统一的文件命名规则
- ✅ **增强状态反馈**
  - 显示歌词下载进度
  - 详细的下载完成提示

### v1.0.0
- ✅ 实现歌曲搜索功能
- ✅ 显示前10个搜索结果
- ✅ 支持选择和下载歌曲
- ✅ 显示API调用信息
- ✅ 显示URL解析详情
- ✅ 实时下载进度显示
- ✅ 双击快速下载
- ✅ 自定义保存位置

## 📮 反馈与建议

如果在使用过程中遇到问题或有改进建议，欢迎反馈！

---

**祝你使用愉快！🎵**

